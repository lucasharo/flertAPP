var _={indexKey:function(){return"~~"},isCommonJS:function(){return"undefined"!=typeof module},isString:function(e){return"string"==typeof e||e instanceof String},isObject:function(e){return null!==e&&"object"==typeof e},hasMultipleCriteria:function(e){return e.length>1},createKey:function(e,t){return""+e+_.indexKey()+t},getPathFromRef:function(e){var t=3,r=e.toString().split("/");return r.slice(t,r.length).join("/")},merge:function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},keys:function(e){return Object.keys(e)},values:function(e){return Object.keys(e).map(function(t){return e[t]})},encodeBase64:function(e){return this.isCommonJS()?new Buffer(e).toString("base64"):window.btoa(e)},arraysToObject:function(e,t){var r={},n=0;return e.forEach(function(e){var o=t[n];r[e]=o,n++}),r}},Querybase=function(){function e(e,t){var r=this;this._assertFirebaseRef(e),this._assertIndexes(t),this.ref=function(){return e},this.indexOn=function(){return t},this.getKey=function(){return r.ref().getKey()},this.encodedKeys=function(){return r.encodeKeys(r.indexOn())}}return e.prototype._assertFirebaseRef=function(e){if(null===e||void 0===e||!e.on)throw new Error("No Firebase Reference provided in the Querybase constructor.")},e.prototype._assertIndexes=function(e){if(null===e||void 0===e)throw new Error("No indexes provided in the Querybase constructor. Querybase uses the indexOn() getter to create the composite queries for the where() method.")},e.prototype.set=function(e){var t=this.indexify(e);this.ref().set(t)},e.prototype.update=function(e){var t=this.indexify(e);this.ref().update(t)},e.prototype.push=function(e){if(!e)return this.ref().push();if(1===_.keys(e).length)return this.ref().push(e);var t=this.indexify(e),r=_.merge(t,e),n=this.ref().push();return n.set(r),n},e.prototype.remove=function(){return this.ref().remove()},e.prototype.child=function(t,r){return new e(this.ref().child(t),r)},e.prototype._createQueryPredicate=function(e){var t=_.keys(e),r=_.values(e);if(this._warnAboutIndexOnRule(),!_.hasMultipleCriteria(t))return{predicate:t[0],value:r[0]};var n=this.encodeKey(t.join(_.indexKey())),o=this.encodeKey(r.join(_.indexKey()));return{predicate:n,value:o}},e.prototype._createChildOrderedQuery=function(e){return new QuerybaseQuery(this.ref().orderByChild(e))},e.prototype._createEqualToQuery=function(e){return this.ref().orderByChild(e.predicate).equalTo(e.value)},e.prototype.where=function(e){if(_.isString(e))return this._createChildOrderedQuery(e);var t=this._createQueryPredicate(e);return this._createEqualToQuery(t)},e.prototype._createCompositeIndex=function(e,t,r){if(!Array.isArray(e))throw new Error("_createCompositeIndex expects an array for the first parameter: found "+e.toString());if(0===e.length)throw new Error("_createCompositeIndex expect an array with multiple elements for the first parameter. Found an array with length of "+e.length);if(!_.isObject(t))throw new Error("_createCompositeIndex expects an object for the second parameter: found "+t.toString());var n=e.slice(),o=n.shift();return r=r||{},n.forEach(function(e){var i="",u="";r[_.createKey(o,e)]=_.createKey(t[o],t[e]),n.forEach(function(e){i=_.createKey(i,e),u=_.createKey(u,t[e])}),r[o+i]=t[o]+u}),0!==n.length&&this._createCompositeIndex(n,t,r),r},e.prototype._encodeCompositeIndex=function(e){if(!_.isObject(e))throw new Error("_encodeCompositeIndex expects an object: found "+e.toString());var t=_.values(e),r=_.keys(e),n=this.encodeKeys(t),o=this.encodeKeys(r);return _.arraysToObject(o,n)},e.prototype.indexify=function(e){var t=this._createCompositeIndex(this.indexOn(),e);return this._encodeCompositeIndex(t)},e.prototype.encodeKey=function(e){return"querybase"+_.indexKey()+_.encodeBase64(e)},e.prototype.encodeKeys=function(e){var t=this;return e.map(function(e){return t.encodeKey(e)})},e.prototype._warnAboutIndexOnRule=function(){var e=this.encodedKeys(),t='\n"'+_.getPathFromRef(this.ref())+'": {\n  "._indexOn": ['+_.keys(e).map(function(t){return'"'+e[t]+'"'}).join(", ")+"]\n}";console.warn("Add this rule to drastically improve performance of your Realtime Database queries: \n "+t)},e}(),QuerybaseQuery=function(){function e(e){this.query=function(){return e}}return e.prototype.lessThan=function(e){return this.query().endAt(e)},e.prototype.greaterThan=function(e){return this.query().startAt(e)},e.prototype.equalTo=function(e){return this.query().equalTo(e)},e.prototype.startsWith=function(e){var t=e.substr(0,1);return this.query().startAt(t).endAt(e+"ï£¿")},e.prototype.between=function(e,t){return this.query().startAt(e).endAt(t)},e}(),querybaseExport={ref:function(e,t){return new Querybase(e,t)}};_.isCommonJS()?(module.exports=querybaseExport,module.exports.Querybase=Querybase,module.exports.QuerybaseUtils=_,module.exports.QuerybaseQuery=QuerybaseQuery):(window.querybase=querybaseExport,window.querybase.Querybase=Querybase,window.querybase.QuerybaseUtils=_,window.querybase.QuerybaseQuery=QuerybaseQuery);